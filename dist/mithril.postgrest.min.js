/*
    A Mithril.js plugin to authenticate requests against PostgREST
    Copyright (c) 2007 - 2015 Diogo Biazus
    Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
    Version: 1.0.0
*/
!function(a){"object"==typeof exports?a(require("mithril"),require("node-localstorage")):a(m,localStorage)}(function(a,b){var c={},d=function(a){return a.setRequestHeader("Authorization","Bearer "+e()),a},e=function(a){return a?b.setItem("postgrest.token",a):b.getItem("postgrest.token")};c.reset=function(){b.removeItem("postgrest.token")},c.init=function(b,f){return c.request=function(c){return a.request(_.extend(c,{url:b+c.url}))},c.requestWithToken=function(b){return a.postgrest.authenticate().then(function(c){var e=_.isFunction(b.config)?_.compose(b.config,d):d;return a.postgrest.request(_.extend(b,{config:e}))})},c.authenticate=function(){var b=a.deferred();return e()?b.resolve({token:e()}):a.request(f).then(function(a){e(a.token),b.resolve({token:a.token})}),b.promise},c},a.postgrest=c});