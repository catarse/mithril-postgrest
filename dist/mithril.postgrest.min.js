/*
    A Mithril.js plugin to authenticate requests against PostgREST
    Copyright (c) 2007 - 2015 Diogo Biazus
    Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
    Version: 1.0.0
*/
!function(a){"object"==typeof exports?a(require("mithril"),require("underscore"),require("node-localstorage")):a(m,_,localStorage)}(function(a,b,c){var d={},e=function(a){return a.setRequestHeader("Authorization","Bearer "+d.token()),a};d.token=function(a){return a?c.setItem("postgrest.token",a):c.getItem("postgrest.token")},d.reset=function(){c.removeItem("postgrest.token")},d.init=function(c,f){return d.request=function(d){return a.request(b.extend(d,{url:c+d.url}))},d.requestWithToken=function(c){return a.postgrest.authenticate().then(function(d){var f=b.isFunction(c.config)?b.compose(c.config,e):e;return a.postgrest.request(b.extend(c,{config:f}))})},d.authenticate=function(){var b=a.deferred();return d.token()?b.resolve({token:d.token()}):a.request(f).then(function(a){d.token(a.token),b.resolve({token:a.token})}),b.promise},d},a.postgrest=d});