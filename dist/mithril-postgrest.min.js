var Postgrest=function(e,t,n){"use strict";function r(r){var i=r||n,a={},c=e(),s=function(e,n){return n&&t.isFunction(n.config)?t.compose(n.config,e):e},l=function(e){return function(n){return t.each(e,function(e,t){n.setRequestHeader(t,e)}),n}},f=function(e,n){return t.extend({},n,{config:s(l(e),n)})},d=function(n,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e(o);return i.load=function(){return new Promise(function(e,o){i(!0),n(t.extend({},r,{background:!1})).then(function(t){i(!1),e(t)})["catch"](function(e){i(!1),o(e)})})},i},h={Prefer:"return=representation"};return a.token=c,a.init=function(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a.request=function(e){var r=function(e){try{return JSON.parse(e.responseText)}catch(t){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}},u=f(o,t.extend({extract:r},e,{url:n+e.url}));return i.request(u)};var u=e(!1);return a.authenticate=function(e){var n=e||new Promise(function(e,n){var o=function a(){c()?e({token:c()}):u()?setTimeout(a,250):(u(!0),i.request(t.extend({},r)).then(function(t){u(!1),c(t.token),e({token:c()})})["catch"](function(e){u(!1),n(e)}))};o()});return n},a.requestWithToken=function(e){return a.authenticate().then(function(){return a.request(f({Authorization:"Bearer "+c()},e))})["catch"](function(){return a.request(e)})},a.loader=t.partial(d,a.request),a.loaderWithToken=t.partial(d,a.requestWithToken),a.model=function(n){var r=function(e,t){if(t){var n=function(){var n=(e-1)*t,r=n+t-1;return n+"-"+r};return{"Range-unit":"items",Range:n()}}},o=e(10),u={url:"/"+n},c=function(e,n,o,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=t.extend({},{Prefer:"count=none"},a,r(n,o));return f(c,t.extend({},i,u,{method:"GET",data:e}))},s=function(e,t){return t.url+="?"+i.buildQueryString(e),t},l=function(e){return a.request(t.extend({},e,u,{method:"OPTIONS"}))},d=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.extend({},h,r);return f(o,t.extend({},n,u,{method:"POST",data:e}))},g=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.extend({},h,r);return s(e,f(o,t.extend({},n,u,{method:"DELETE"})))},p=function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t.extend({},h,o);return s(e,f(i,t.extend({},r,u,{method:"PATCH",data:n})))},v=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return c(e,t||1,o(),n,r)},m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(e,1,1,t,n)};return{pageSize:o,getPageOptions:v,getRowOptions:m,patchOptions:p,postOptions:d,deleteOptions:g,getPage:t.compose(a.request,v),getRow:t.compose(a.request,m),patch:t.compose(a.request,p),post:t.compose(a.request,d),deleteRequest:t.compose(a.request,g),getPageWithToken:t.compose(a.requestWithToken,v),getRowWithToken:t.compose(a.requestWithToken,m),patchWithToken:t.compose(a.requestWithToken,p),postWithToken:t.compose(a.requestWithToken,d),deleteWithToken:t.compose(a.requestWithToken,g),options:l}},a},a.filtersVM=o,a.paginationVM=u(r),a}e=e&&e.hasOwnProperty("default")?e["default"]:e,t=t&&t.hasOwnProperty("default")?t["default"]:t,n=n&&n.hasOwnProperty("default")?n["default"]:n;var o=function(n){var r={},o=function(){function n(e){return"("+Object.keys(e).map(function(t){return"or"===t||"and"===t?""+t+n(e[t]):""+Object.keys(e[t]).map(function(r){return"or"===r||"and"===r?""+r+n(e[t][r]):t+"."+r+"."+e[t][r]}).join(",")}).join(",")+")"}var o=e(""),i=function(e){return arguments.length>0?(o(e),r):o()};return i.toFilter=function(){return t.isString(i())?i().trim():i()},i.logicOperators=function(){return n(i.toFilter())},i},i=t.reduce(n,function(e,t,n){return"between"===t?e[n]={lte:o(),gte:o()}:e[n]=o(),e},{order:o()}),u=function(){return t.reduce(i,function(e,r,o){if("order"!==o){var i=n[o];if(t.isFunction(r.toFilter)&&(void 0===r.toFilter()||""===r.toFilter()))return e;if("ilike"===i||"like"===i)e[o]=i+".*"+r.toFilter()+"*";else if("@@"===i)e[o]=i+"."+r.toFilter().replace(/\s+/g,"&");else if("between"===i){if(!r.lte.toFilter()&&!r.gte.toFilter())return e;e[o]=[],r.gte()&&e[o].push("gte."+r.gte.toFilter()),r.lte()&&e[o].push("lte."+r.lte.toFilter())}else"is.null"===i?e[o]=null===r.toFilter()?"is.null":"not.is.null":"or"===i||"and"===i?e[i]=r.logicOperators():"select"===i?e[i]=r.toFilter():e[o]=i+"."+r.toFilter()}return e},{})},a=function(){var e=function(){return i.order()&&t.reduce(i.order(),function(e,t,n){return e.push(n+"."+t),e},[]).join(",")},n=e()?{order:e()}:{};return t.extend({},n,u())};return t.extend(r,i,{parameters:a,parametersWithoutOrder:u})},i=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(c){o=!0,i=c}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(n){return function(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e([]),c=r||"id.desc",s=e({order:c}),l=e(!1),f=e(1),d=e(),h=u?n.getPageWithToken:n.getPage,g=e(),p=function(){return new Promise(function(e,n){var r=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var n=e.getResponseHeader("Content-Range");if(t.isString(n)){var r=n.split("/"),o=i(r,2),u=o[0],a=o[1],c=u.split("-"),s=i(c,2),l=s[0],f=s[1],h=parseInt(f)+1||0,p=parseInt(l)||0;g(parseInt(a)),d(h-p)}try{return JSON.parse(e.responseText)}catch(v){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};l(!0),h(s(),f(),{background:!1,extract:r},o).then(function(n){a(t.union(a(),n)),l(!1),e(a())})["catch"](function(e){l(!1),g(0),n(e)})})},v=function(e){return s(t.extend({order:c},e)),a([]),f(1),p()},m=function(){return n.pageSize()>d()},T=function(){return f(f()+1),p()};return{collection:a,firstPage:v,isLoading:l,nextPage:T,isLastPage:m,total:g,resultsCount:d}}};return r}(prop,_,m);